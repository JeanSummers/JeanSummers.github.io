import{r as c,F as he,G as fe,H as J,J as me,K as xe,L as ve,M as Q,N as ge,O as X,Q as ye,A as P,j as e,C as Y,D as je,R as be}from"./index-z0nbMM35.js";import{L as Se,C as Te,B as A,u as ke,S as Ce,R as Pe,T as Re,a as Ee}from"./usePagination-IYKXV6FN.js";import{l as we,C as Le,j as ze,T as H,G as De,P as _e,E as Ie,k as C,h as Me}from"./ResourceIcon-l9-PGcZH.js";import{u as Fe}from"./shallow-DnwZrrId.js";const Be="Error preloading route! ☝️";function Ne(o,r){const s=he(),[p,m]=c.useState(!1),n=c.useRef(!1),h=fe(r),{activeProps:f=()=>({className:"active"}),inactiveProps:R=()=>({}),activeOptions:l,to:j,preload:b,preloadDelay:i,hashScrollIntoView:u,replace:x,startTransition:Z,resetScroll:ee,viewTransition:te,children:V,target:S,disabled:d,style:E,className:w,onClick:L,onFocus:z,onMouseEnter:D,onMouseLeave:_,onTouchStart:I,ignoreBlocker:se,...ae}=o,{params:Oe,search:Ge,hash:Ue,state:qe,mask:We,reloadDocument:$e,...K}=ae,O=c.useMemo(()=>{try{return new URL(`${j}`),"external"}catch{}return"internal"},[j]),re=J({select:t=>t.location.search,structuralSharing:!0}),G=me({select:t=>{var a;return o.from??((a=t[t.length-1])==null?void 0:a.fullPath)}}),v=c.useMemo(()=>({...o,from:G}),[o,G]),g=c.useMemo(()=>s.buildLocation(v),[s,v,re]),T=c.useMemo(()=>v.reloadDocument?!1:b??s.options.defaultPreload,[s.options.defaultPreload,b,v.reloadDocument]),ne=i??s.options.defaultPreloadDelay??0,M=J({select:t=>{if(l!=null&&l.exact){if(!ge(t.location.pathname,g.pathname,s.basepath))return!1}else{const a=X(t.location.pathname,s.basepath).split("/");if(!X(g.pathname,s.basepath).split("/").every((de,pe)=>de===a[pe]))return!1}return((l==null?void 0:l.includeSearch)??!0)&&!ye(t.location.search,g.search,{partial:!(l!=null&&l.exact),ignoreUndefined:!(l!=null&&l.explicitUndefined)})?!1:l!=null&&l.includeHash?t.location.hash===g.hash:!0}}),y=c.useCallback(()=>{s.preloadRoute(v).catch(t=>{console.warn(t),console.warn(Be)})},[v,s]),oe=c.useCallback(t=>{t!=null&&t.isIntersecting&&y()},[y]);if(xe(h,oe,{rootMargin:"100px"},{disabled:!!d||T!=="viewport"}),ve(()=>{n.current||!d&&T==="render"&&(y(),n.current=!0)},[d,y,T]),O==="external")return{...K,ref:h,type:O,href:j,...V&&{children:V},...S&&{target:S},...d&&{disabled:d},...E&&{style:E},...w&&{className:w},...L&&{onClick:L},...z&&{onFocus:z},...D&&{onMouseEnter:D},..._&&{onMouseLeave:_},...I&&{onTouchStart:I}};const le=t=>{if(!d&&!He(t)&&!t.defaultPrevented&&(!S||S==="_self")&&t.button===0){t.preventDefault(),we.flushSync(()=>{m(!0)});const a=s.subscribe("onResolved",()=>{a(),m(!1)});return s.navigate({...v,replace:x,resetScroll:ee,hashScrollIntoView:u,startTransition:Z,viewTransition:te,ignoreBlocker:se})}},U=t=>{d||T&&y()},ie=U,ce=t=>{if(d)return;const a=t.target||{};if(T){if(a.preloadTimeout)return;a.preloadTimeout=setTimeout(()=>{a.preloadTimeout=null,y()},ne)}},ue=t=>{if(d)return;const a=t.target||{};a.preloadTimeout&&(clearTimeout(a.preloadTimeout),a.preloadTimeout=null)},k=t=>a=>{var N;(N=a.persist)==null||N.call(a),t.filter(Boolean).forEach($=>{a.defaultPrevented||$(a)})},F=M?Q(f,{})??{}:{},B=M?{}:Q(R,{}),q=[w,F.className,B.className].filter(Boolean).join(" "),W={...E,...F.style,...B.style};return{...K,...F,...B,href:d?void 0:g.maskedLocation?s.history.createHref(g.maskedLocation.href):s.history.createHref(g.href),ref:h,onClick:k([L,le]),onFocus:k([z,U]),onMouseEnter:k([D,ce]),onMouseLeave:k([_,ue]),onTouchStart:k([I,ie]),disabled:!!d,target:S,...Object.keys(W).length&&{style:W},...q&&{className:q},...d&&{role:"link","aria-disabled":!0},...M&&{"data-status":"active","aria-current":"page"},...p&&{"data-transitioning":"transitioning"}}}const Ae=c.forwardRef((o,r)=>{const{_asChild:s,...p}=o,{type:m,ref:n,...h}=Ne(p,r),f=typeof p.children=="function"?p.children({isActive:h["data-status"]==="active"}):p.children;return typeof s>"u"&&delete h.disabled,c.createElement(s||"a",{...h,ref:n},f)});function He(o){return!!(o.metaKey||o.altKey||o.ctrlKey||o.shiftKey)}function Ve({trading:o,...r}){const s=P(n=>n.remove),p=P(n=>n.buy),m=P(n=>n.sell);return e.jsxs(Le,{variant:"elevation",sx:{display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[e.jsxs(ze,{children:[e.jsxs(H,{variant:"h5",fontSize:{xs:20,sm:24},component:"div",display:"flex",alignItems:"center",gap:1,lineHeight:1,children:[e.jsx(De,{name:r.icon,category:"resources",sx:{color:n=>n.palette.text.secondary}}),r.name]}),e.jsxs(Y,{sx:{color:"text.secondary",mb:1,mt:.25},display:"flex",gap:1,children:[e.jsx(Se,{title:r.source,color:"textSecondary",fontSize:"inherit",component:Ae,to:r.type.includes("Существо")?"/creatures":"/plants",search:{c:r.source},children:r.type}),e.jsx("span",{children:r.attribute}),e.jsx("span",{children:r.rank})]}),e.jsx(H,{sx:{color:"text.secondary",fontSize:14,mb:.25},children:r.effect}),e.jsx(H,{variant:"body2",children:r.description})]}),e.jsx(Te,{children:o?e.jsx(A,{size:"small",variant:"text",onClick:()=>s(r.name),children:"Снять с обмена"}):e.jsxs(e.Fragment,{children:[e.jsx(A,{size:"small",onClick:()=>m(r),children:"Продать"}),e.jsx(A,{size:"small",onClick:()=>p(r),children:"Купить"})]})})]})}const Ke=c.memo(function(){const{status:r,data:s,error:p}=je(),m=P(Fe(i=>Object.fromEntries([...i.buying.map(u=>u.name),...i.selling.map(u=>u.name)].map(u=>[u,!0])))),[n,h]=be("",500),[f,R]=c.useState([]),l=c.useMemo(()=>{const i=n.trim().toLowerCase();let u=(s==null?void 0:s.items)||[];return f.length&&(u=u.filter(x=>f.includes(x.rank))),i?u.filter(x=>[x.name,x.type,x.attribute].join(";").toLowerCase().includes(i)):u},[s,f,n]),{paginate:j,...b}=ke(l.length,9);return r==="pending"?e.jsx(_e,{}):r==="error"?e.jsx(Ie,{message:p.message}):e.jsxs(e.Fragment,{children:[e.jsxs(C,{container:!0,spacing:{xs:1,sm:1,md:2},children:[e.jsx(C,{size:12,children:e.jsx(Me,{placeholder:"Поиск",fullWidth:!0,startAdornment:e.jsx(Ce,{sx:{color:"action.active",mr:1,my:.5}}),onChange:i=>h(i.target.value)})}),e.jsx(C,{display:"flex",size:{sm:12,md:6},justifyContent:"flex-start",children:e.jsx(Pe,{ranks:f,setRanks:R})}),e.jsx(C,{size:{xs:12,sm:12,md:6},children:e.jsx(Re,{...b})})]}),e.jsx(Y,{sx:{width:"100%",display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(min(350px, 100%), 1fr))",gap:2,pb:2},children:j(l).map(i=>e.jsx(Ve,{trading:m[i.name],...i},i.name))}),e.jsx(Ee,{...b})]})}),Ze=Ke;export{Ze as component};
