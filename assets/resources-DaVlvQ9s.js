import{r as o,e as he,f as pe,g as Y,h as fe,i as me,k as xe,l as Z,m as ve,n as ee,o as ge,u as ye,a as E,p as je,j as t,B as Se}from"./index-CFGERTp2.js";import{u as be,S as Te,R as ke,T as Ce,L as Pe,C as we,B as K,a as Ee}from"./usePagination-BixAJCE7.js";import{r as Le,P as Re,E as ze,G as L,I as Ie,C as _e,a as De,T as R}from"./PageLoader-8XAVz2Yt.js";import{G as Me}from"./ResourceIcon-DfJS213U.js";import{u as Fe}from"./shallow-DEu4kAmO.js";const Be="Error preloading route! ☝️";function Ne(i,x){const a=he(),[d,y]=o.useState(!1),v=o.useRef(!1),u=pe(x),{activeProps:j=()=>({className:"active"}),inactiveProps:k=()=>({}),activeOptions:l,to:h,preload:C,preloadDelay:P,hashScrollIntoView:z,replace:w,startTransition:e,resetScroll:n,viewTransition:p,children:O,target:S,disabled:c,style:I,className:_,onClick:D,onFocus:M,onMouseEnter:F,onMouseLeave:B,onTouchStart:N,ignoreBlocker:te,...se}=i,{params:Ge,search:Ke,hash:Oe,state:Ue,mask:qe,reloadDocument:We,...U}=se,q=o.useMemo(()=>{try{return new URL(`${h}`),"external"}catch{}return"internal"},[h]),ae=Y({select:s=>s.location.search,structuralSharing:!0}),W=fe({select:s=>{var r;return i.from??((r=s[s.length-1])==null?void 0:r.fullPath)}}),f=o.useMemo(()=>({...i,from:W}),[i,W]),m=o.useMemo(()=>a.buildLocation(f),[a,f,ae]),b=o.useMemo(()=>f.reloadDocument?!1:C??a.options.defaultPreload,[a.options.defaultPreload,C,f.reloadDocument]),re=P??a.options.defaultPreloadDelay??0,V=Y({select:s=>{if(l!=null&&l.exact){if(!ve(s.location.pathname,m.pathname,a.basepath))return!1}else{const r=ee(s.location.pathname,a.basepath).split("/");if(!ee(m.pathname,a.basepath).split("/").every((ue,de)=>ue===r[de]))return!1}return((l==null?void 0:l.includeSearch)??!0)&&!ge(s.location.search,m.search,{partial:!(l!=null&&l.exact),ignoreUndefined:!(l!=null&&l.explicitUndefined)})?!1:l!=null&&l.includeHash?s.location.hash===m.hash:!0}}),g=o.useCallback(()=>{a.preloadRoute(f).catch(s=>{console.warn(s),console.warn(Be)})},[f,a]),ne=o.useCallback(s=>{s!=null&&s.isIntersecting&&g()},[g]);if(me(u,ne,{rootMargin:"100px"},{disabled:!!c||b!=="viewport"}),xe(()=>{v.current||!c&&b==="render"&&(g(),v.current=!0)},[c,g,b]),q==="external")return{...U,ref:u,type:q,href:h,...O&&{children:O},...S&&{target:S},...c&&{disabled:c},...I&&{style:I},..._&&{className:_},...D&&{onClick:D},...M&&{onFocus:M},...F&&{onMouseEnter:F},...B&&{onMouseLeave:B},...N&&{onTouchStart:N}};const oe=s=>{if(!c&&!Ae(s)&&!s.defaultPrevented&&(!S||S==="_self")&&s.button===0){s.preventDefault(),Le.flushSync(()=>{y(!0)});const r=a.subscribe("onResolved",()=>{r(),y(!1)});return a.navigate({...f,replace:w,resetScroll:n,hashScrollIntoView:z,startTransition:e,viewTransition:p,ignoreBlocker:te})}},$=s=>{c||b&&g()},ie=$,le=s=>{if(c)return;const r=s.target||{};if(b){if(r.preloadTimeout)return;r.preloadTimeout=setTimeout(()=>{r.preloadTimeout=null,g()},re)}},ce=s=>{if(c)return;const r=s.target||{};r.preloadTimeout&&(clearTimeout(r.preloadTimeout),r.preloadTimeout=null)},T=s=>r=>{var G;(G=r.persist)==null||G.call(r),s.filter(Boolean).forEach(X=>{r.defaultPrevented||X(r)})},A=V?Z(j,{})??{}:{},H=V?{}:Z(k,{}),J=[_,A.className,H.className].filter(Boolean).join(" "),Q={...I,...A.style,...H.style};return{...U,...A,...H,href:c?void 0:m.maskedLocation?a.history.createHref(m.maskedLocation.href):a.history.createHref(m.href),ref:u,onClick:T([D,oe]),onFocus:T([M,$]),onMouseEnter:T([F,le]),onMouseLeave:T([B,ce]),onTouchStart:T([N,ie]),disabled:!!c,target:S,...Object.keys(Q).length&&{style:Q},...J&&{className:J},...c&&{role:"link","aria-disabled":!0},...V&&{"data-status":"active","aria-current":"page"},...d&&{"data-transitioning":"transitioning"}}}const Ve=o.forwardRef((i,x)=>{const{_asChild:a,...d}=i,{type:y,ref:v,...u}=Ne(d,x),j=typeof d.children=="function"?d.children({isActive:u["data-status"]==="active"}):d.children;return typeof a>"u"&&delete u.disabled,o.createElement(a||"a",{...u,ref:v},j)});function Ae(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}const He=o.memo(function(){const{status:x,data:a,error:d}=ye(),y=E(e=>e.remove),v=E(e=>e.buy),u=E(e=>e.sell),j=E(Fe(e=>Object.fromEntries([...e.buying.map(n=>n.id),...e.selling.map(n=>n.id)].map(n=>[n,!0])))),[k,l]=je("",500),[h,C]=o.useState([]),P=o.useMemo(()=>{const e=k.trim().toLowerCase();let n=a||[];return h.length&&(n=n.filter(p=>h.includes(p.rank))),e?n.filter(p=>p.name.toLowerCase().includes(e)||p.source.toLowerCase().includes(e)||p.attribute.toLowerCase().includes(e)):n},[a,h,k]),{paginate:z,...w}=be(P.length,9);return x==="pending"?t.jsx(Re,{}):x==="error"?t.jsx(ze,{message:d.message}):t.jsxs(t.Fragment,{children:[t.jsxs(L,{container:!0,spacing:{xs:1,sm:1,md:2},children:[t.jsx(L,{size:12,children:t.jsx(Ie,{placeholder:"Поиск",fullWidth:!0,startAdornment:t.jsx(Te,{sx:{color:"action.active",mr:1,my:.5}}),onChange:e=>l(e.target.value)})}),t.jsx(L,{display:"flex",size:{sm:12,md:6},justifyContent:"flex-start",children:t.jsx(ke,{ranks:h,setRanks:C})}),t.jsx(L,{size:{xs:12,sm:12,md:6},children:t.jsx(Ce,{...w})})]}),t.jsx(Se,{sx:{width:"100%",display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(min(350px, 100%), 1fr))",gap:2,pb:2},children:z(P).map(e=>t.jsxs(_e,{variant:"elevation",sx:{display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[t.jsxs(De,{children:[t.jsxs(R,{variant:"h5",fontSize:{xs:20,sm:24},component:"div",display:"flex",alignItems:"center",gap:1,lineHeight:1,children:[t.jsx(Me,{name:e.icon,category:"resources",sx:{color:n=>n.palette.text.secondary}})," ",t.jsxs("div",{children:[" ",e.name,t.jsx(Pe,{color:"textSecondary",fontSize:"inherit",component:Ve,to:e.type.includes("Существо")?"/creatures":"/plants",search:{c:e.source},ml:1,children:e.source})]})]}),t.jsxs(R,{sx:{color:"text.secondary",mb:1.5},children:[e.attribute," ",e.rank]}),t.jsx(R,{gutterBottom:!0,sx:{color:"text.secondary",fontSize:14},children:e.effect}),t.jsx(R,{variant:"body2",children:e.description})]}),t.jsx(we,{children:j[e.id]?t.jsx(K,{size:"small",variant:"text",onClick:()=>y(e.id),children:"Снять с обмена"}):t.jsxs(t.Fragment,{children:[t.jsx(K,{size:"small",onClick:()=>u(e),children:"Продать"}),t.jsx(K,{size:"small",onClick:()=>v(e),children:"Купить"})]})})]},e.id))}),t.jsx(Ee,{...w})]})}),Ze=He;export{Ze as component};
